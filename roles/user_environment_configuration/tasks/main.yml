---
- name: Configure vim/neovim
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "0644"
  with_items:
    - { src: init.vim, dest: "{{ ansible_user_dir }}/.config/nvim/init.vim" }
    - { src: .vimrc, dest: "{{ ansible_user_dir }}/.vimrc" }
    - { src: plug.vim, dest: "{{ ansible_user_dir }}/.local/share/nvim/site/autoload" }

- name: Configure custom utilities
  become: true
  ansible.builtin.copy:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    mode: "0755"
  with_items:
    - { src: dirsize, dest: /usr/local/bin/dirsize }
    - { src: git_starter, dest: /usr/local/bin/git_starter }
    - { src: mkfile, dest: /usr/local/bin/mkfile }
    - { src: renamer, dest: /usr/local/bin/renamer }

- name: Get backup configuration
  ansible.builtin.include_vars: "backup.yml"

- name: Restore backup
  ansible.builtin.unarchive:
    src: "{{ backup_file_path }}"
    owner: "{{ ansible_effective_user_id }}"
    group: "{{ ansible_effective_group_id }}"
    dest: "/"
  when: backup_file_path
